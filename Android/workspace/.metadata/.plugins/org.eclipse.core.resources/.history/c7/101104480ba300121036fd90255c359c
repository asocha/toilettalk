package com.pottymouth.toilettalk;

import java.io.IOException;
import java.io.InputStream;

import org.apache.http.HttpEntity;
import org.apache.http.HttpResponse;
import org.apache.http.client.HttpClient;
import org.apache.http.client.methods.HttpGet;
import org.apache.http.impl.client.DefaultHttpClient;
import org.apache.http.protocol.BasicHttpContext;
import org.apache.http.protocol.HttpContext;

import android.os.AsyncTask;

public class ToiletTalkAPI {
	
	String server;
			
	public ToiletTalkAPI()
	{
		this.server = "http://toilettalkapiv1.apiary.io/index.php/api/toilettalkapi/";
	}
	
	public String hello()
	{
		return "hello";
	}
	
	public int send(String method, String uri)
	{
		
		return 0;
	}
	
	public int send(String method, String uri, String param)
	{
		
		return 0;
	}
	
	private class LongRunningGetIO extends AsyncTask <Void, Void, String> {
		protected String getASCIIContentFromEntity(HttpEntity entity) throws IllegalStateException, IOException {
			InputStream in = entity.getContent();
			StringBuffer out = new StringBuffer();
			
			int n = 1;
			
			while (n>0) {
				byte[] b = new byte[4096];
				n =  in.read(b);
				if (n>0) out.append(new String(b, 0, n));
			}
		return out.toString();
		}
		
		protected String doInBackground(String... params) {
		    String method = params[0];
		    
			HttpClient httpClient = new DefaultHttpClient();
			HttpContext localContext = new BasicHttpContext();
			String text = null;
			
			if(method.equalsIgnoreCase("GET"))
			{
				HttpGet httpGet = new HttpGet("http://www.cheesejedi.com/rest_services/get_big_cheese.php?puzzle=1");
				
				try {
					HttpResponse response = httpClient.execute(httpGet, localContext);
					HttpEntity entity = response.getEntity();
					text = getASCIIContentFromEntity(entity);
				} catch (Exception e) {
				return e.getLocalizedMessage();
				}
			}
			
			if(method.equalsIgnoreCase("POST"))
			{
				HttpGet httpGet = new HttpGet("http://www.cheesejedi.com/rest_services/get_big_cheese.php?puzzle=1");
				
				try {
					HttpResponse response = httpClient.execute(httpGet, localContext);
					HttpEntity entity = response.getEntity();
					text = getASCIIContentFromEntity(entity);
				} catch (Exception e) {
				return e.getLocalizedMessage();
				}
			}
			
			if(method.equalsIgnoreCase("DELETE"))
			{
				HttpGet httpGet = new HttpGet("http://www.cheesejedi.com/rest_services/get_big_cheese.php?puzzle=1");
				
				try {
					HttpResponse response = httpClient.execute(httpGet, localContext);
					HttpEntity entity = response.getEntity();
					text = getASCIIContentFromEntity(entity);
				} catch (Exception e) {
				return e.getLocalizedMessage();
				}
			}
			
			if(method.equalsIgnoreCase("PUT"))
			{
				HttpGet httpGet = new HttpGet("http://www.cheesejedi.com/rest_services/get_big_cheese.php?puzzle=1");
				
				try {
					HttpResponse response = httpClient.execute(httpGet, localContext);
					HttpEntity entity = response.getEntity();
					text = getASCIIContentFromEntity(entity);
				} catch (Exception e) {
				return e.getLocalizedMessage();
				}
			}
			
			return text;
		}
	}
}